{# Updated by Claude AI on 2025-09-12 #}
{% extends "base.html" %}

{% block content %}
<div class="row">
    <div class="col-lg-6">
        <h1>Register for Vancouver Christmas Bird Count</h1>
        <p class="lead">Join Nature Vancouver's annual Christmas Bird Count and help us track bird populations in the Vancouver area.</p>
        
        <form method="POST" action="{{ url_for('main.register') }}">
            {{ csrf_token() }}
            <div class="mb-3">
                <label for="first_name" class="form-label">First Name *</label>
                <input type="text" class="form-control" id="first_name" name="first_name" required>
            </div>
            
            <div class="mb-3">
                <label for="last_name" class="form-label">Last Name *</label>
                <input type="text" class="form-control" id="last_name" name="last_name" required>
            </div>
            
            <div class="mb-3">
                <label for="email" class="form-label">Email Address *</label>
                <input type="email" class="form-control" id="email" name="email" required>
            </div>
            
            <div class="mb-3">
                <label for="phone" class="form-label">Phone Number</label>
                <input type="tel" class="form-control" id="phone" name="phone">
            </div>
            
            <div class="mb-3">
                <label for="skill_level" class="form-label">Birding Skill Level *</label>
                <select class="form-select" id="skill_level" name="skill_level" required>
                    <option value="">Choose...</option>
                    <option value="Newbie">Newbie - I'm new to birding</option>
                    <option value="Beginner">Beginner - I know some common birds</option>
                    <option value="Intermediate">Intermediate - I can identify many species</option>
                    <option value="Expert">Expert - I'm experienced with identification</option>
                </select>
            </div>
            
            <div class="mb-3">
                <label for="experience" class="form-label">CBC Experience *</label>
                <select class="form-select" id="experience" name="experience" required>
                    <option value="">Choose...</option>
                    <option value="None">This is my first Christmas Bird Count</option>
                    <option value="1-2 counts">I've done 1-2 Christmas Bird Counts</option>
                    <option value="3+ counts">I've done 3 or more Christmas Bird Counts</option>
                </select>
            </div>
            
            <div class="mb-3">
                <label class="form-label">I would like to: *</label>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="participation_type" id="regular" value="regular" required>
                    <label class="form-check-label" for="regular">Count birds in the field as part of a team</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="participation_type" id="feeder" value="FEEDER" required>
                    <label class="form-check-label" for="feeder">Count birds at my home feeder</label>
                </div>
                <div class="mt-2">
                    <a href="https://view.publitas.com/birds-canada-gykxaz9yrrpp/field-counters-guide-to-cbc_cheat-sheet-with-datasheet/page/1" 
                       target="_blank" class="btn btn-sm btn-outline-primary me-2">Guide for Field Counters</a>
                    <a href="https://view.publitas.com/birds-canada-gykxaz9yrrpp/feeder-counters-guide-to-cbc_cheat-sheet-with-datasheet/page/1" 
                       target="_blank" class="btn btn-sm btn-outline-info">Guide for Feeder Counters</a>
                </div>
            </div>
            
            <div class="mb-3">
                <label for="preferred_area" class="form-label">Preferred Count Area *</label>
                <select class="form-select" id="preferred_area" name="preferred_area" required>
                    <option value="">Choose your preferred area...</option>
                    <option value="UNASSIGNED">Wherever I'm needed most</option>
                    <optgroup label="Count Areas">
                        {% for area_code in public_areas %}
                        <option value="{{ area_code }}">{{ area_code }} - {{ get_area_info(area_code).name.split(' - ', 1)[1] if ' - ' in get_area_info(area_code).name else get_area_info(area_code).name }}</option>
                        {% endfor %}
                    </optgroup>
                </select>
            </div>

            <div class="mb-3">
                <div class="form-check">
                    <input type="checkbox" class="form-check-input" id="has_binoculars" name="has_binoculars">
                    <label class="form-check-label" for="has_binoculars">I have binoculars</label>
                </div>
                <div class="form-check">
                    <input type="checkbox" class="form-check-input" id="spotting_scope" name="spotting_scope">
                    <label class="form-check-label" for="spotting_scope">I can bring a spotting scope</label>
                </div>
            </div>

            <div class="mb-3 form-check">
                <input type="checkbox" class="form-check-input" id="interested_in_leadership" name="interested_in_leadership">
                <label class="form-check-label" for="interested_in_leadership">
                    I am interested in being an <a href="#" id="area-leader-link" class="text-decoration-none">area leader</a>
                </label>
            </div>
            
            <div class="mb-3 form-check">
                <input type="checkbox" class="form-check-input" id="interested_in_scribe" name="interested_in_scribe">
                <label class="form-check-label" for="interested_in_scribe">
                    I would like to be a <a href="#" id="scribe-link" class="text-decoration-none">Scribe</a>
                </label>
            </div>
            
            <div class="mb-3">
                <label for="notes_to_organizers" class="form-label">Notes to Organizers</label>
                <textarea class="form-control" id="notes_to_organizers" name="notes_to_organizers" 
                          placeholder="I would like to car pool to the meeting point&#10;I would prefer to be assigned to an area in East Vancouver" 
                          rows="3"></textarea>
            </div>
            
            <button type="submit" class="btn btn-primary btn-lg">Register</button>
        </form>
    </div>
    
    <div class="col-lg-6">
        <h3>Select Area on Map</h3>
        <p>Click on an area below to select it automatically:</p>
        <div id="count-area-map" style="height: 400px; border: 1px solid #ccc;"></div>
        <div class="mt-2">
            <small class="text-muted">
                <span class="color-box low-count"></span> 0-3 registered
                <span class="color-box med-count"></span> 4-8 registered
                <span class="color-box high-count"></span> 8+ registered
            </small>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/map.js') }}"></script>
<script src="{{ url_for('static', filename='js/registration.js') }}"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Restore form data if returning from area leader info page
    {% if form_data %}
    const formData = {{ form_data | tojson }};
    
    // Restore form values generically
    for (const [key, value] of Object.entries(formData)) {
        const element = document.querySelector(`[name="${key}"]`);
        if (element) {
            if (element.type === 'checkbox' || element.type === 'radio') {
                if (value === 'on' || value === element.value) {
                    element.checked = true;
                }
            } else {
                element.value = value;
            }
        }
    }
    {% endif %}
    
    // Handle area leader info link
    document.getElementById('area-leader-link').addEventListener('click', function(e) {
        e.preventDefault();
        
        // Collect all form data generically
        const form = document.querySelector('form');
        const formData = new FormData(form);
        const queryParams = new URLSearchParams();
        
        // Add all form data to query parameters
        for (const [key, value] of formData.entries()) {
            if (value) {
                queryParams.append(key, value);
            }
        }
        
        // Navigate to area leader info page with form data
        window.location.href = '{{ url_for("main.area_leader_info") }}?' + queryParams.toString();
    });
    
    // Handle scribe info link
    document.getElementById('scribe-link').addEventListener('click', function(e) {
        e.preventDefault();
        
        // Collect all form data generically
        const form = document.querySelector('form');
        const formData = new FormData(form);
        const queryParams = new URLSearchParams();
        
        // Add all form data to query parameters
        for (const [key, value] of formData.entries()) {
            if (value) {
                queryParams.append(key, value);
            }
        }
        
        // Navigate to scribe info page with form data
        window.location.href = '{{ url_for("main.scribe_info") }}?' + queryParams.toString();
    });
});
</script>
{% endblock %}